- <u>Object</u>: ANY resource within an AD environment such as OUs, printers, users, domain controllers, etc.
- <u>Attributes</u>: descriptors for the characteristics of any object. All attributes have an associated LDAP name you can use when performing LDAP queries
- <u>Schema</u>: a blueprint of an environment. It defines what types of objects can exist in the AD database (and their associated attributes), lists definitions corresponding to objects, and hold information about each of them.
- <u>Domain</u>: a logical group of objects (users, computers, etc.). Domains can operate independently or connected via trust relationships
- <u>Forest</u>: a collection of AD domains. A forest is the topmost container for a collection of AD trees
- <u>Tree</u>: a collection of AD domains that begins at a single root domain.
	- Each domain in a tree shares boundaries with the other domains.
	- A parent-child trust relationship is formed when a domain is added under another domain in a tree
	-  2 trees in the same forest cannot share a name
- <u>Container</u>: an object that holds other objects and have a defined place in the directory subtree hierarchy
- <u>Leaf</u>: an object that does NOT contain other objects; found at the end of the subtree hierarchy
- <u>Global Unique Identifier (GUID)</u>: a unique 128-bit value assigned when a object is created. This value NEVER changes and is the most accurate way to identify an object
- <u>Security Principles</u>: anything that the OS can authenticate (users, computer accounts, threads/processes running on a user/computer account)
- <u>Security Identifier (SID)</u>: a unique identifier for a security principle or security group. Every account, group, and process has its own, and is issued by the Domain Controller then stored in a secure database. There are well known SIDs used to identify users and groups.
- <u>Distinguished Name (DN)</u>: describes the full path to an object in AD
	- `cn=bjones, ou=IT, ou=Employees, dc=inflanefreight, dc=local`
- <u>Relative Distinguished Name (RDN)</u>: a component of the DN that identifies the object as unique from other objects at the current level in the naming hierarchy
![[RDN.png]]
- <u>sAMAccountName</u>: the user's logon name (unique value and <=20 characters)
- <u>userPrincipalName</u>: another way to identify users in AD
	- Consists of a prefix (user account name) and a suffic (domain name) in the format
		- `bjones@inlanefreight.local`
- <u>FSMO Roles</u>: Flexible Single Master Operation roles. Grants DCs the ability to continue authenticating users and granting permissions without interruption
	- Schema Master
	- Domain Naming Master (1 per forest)
	- Relative ID (RID) Master (1 per domain)
	- Primary Domain Controller (PDC) Emulator (1 per domain)
	- Infrastructure Master (1 per domain)
- <u>Global Catalog</u>: a domain controller that stores copies of ALL objects in an AD forest, the current domain, and a partial copy of objects that belong to other domains in the forest. The GC lets users/applications find information about ANY domain in the forest. GC is a feature on a domain controller that performs:
	- Authentication
	- Object Search
- <u>Read-Only Domain Controller (RODC)</u>: A [Read-Only Domain Controller (RODC)](https://docs.microsoft.com/en-us/windows/win32/ad/rodc-and-active-directory-schema) has a read-only Active Directory database. No AD account passwords are cached on an RODC (other than the RODC computer account & RODC KRBTGT passwords.) No changes are pushed out via an RODC's AD database, SYSVOL, or DNS. RODCs also include a read-only DNS server, allow for administrator role separation, reduce replication traffic in the environment, and prevent SYSVOL modifications from being replicated to other DCs.
- <u>Replication</u>: [Replication](https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/replication/active-directory-replication-concepts) happens in AD when AD objects are updated and transferred from one Domain Controller to another. Whenever a DC is added, connection objects are created to manage replication between them. These connections are made by the Knowledge Consistency Checker (KCC) service, which is present on all DCs. Replication ensures that changes are synchronized with all other DCs in a forest, helping to create a backup in case one domain controller fails.
- <u>Service Principal Name (SPN)</u>: A [Service Principal Name (SPN)](https://docs.microsoft.com/en-us/windows/win32/ad/service-principal-names) uniquely identifies a service instance. They are used by Kerberos authentication to associate an instance of a service with a logon account, allowing a client application to request the service to authenticate an account without needing to know the account name.
- <u>Group Policy Object (GPO)</u>: [Group Policy Objects (GPOs)](https://docs.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-objects) are virtual collections of policy settings. Each GPO has a unique GUID. A GPO can contain local file system settings or Active Directory settings. GPO settings can be applied to both user and computer objects. They can be applied to all users and computers within the domain or defined more granularly at the OU level.
- <u>Access Control List (ACL)</u>: the ordered collection of Access Control Entries (ACEs) that apply to an object.
- <u>Access Control Entries (ACEs)</u>: Each Access Control Entry (ACE) in an ACL identifies a trustee (user account, group account, or logon session) and lists the access rights that are allowed, denied, or audited for the given trustee.
- <u>Discretionary Access Control List (DACL)</u>: DACLs define which security principles are granted or denied access to an object; it contains a list of ACEs. When a process tries to access a securable object, the system checks the ACEs in the object's DACL to determine whether or not to grant access. If an object does NOT have a DACL, then the system will grant full access to everyone, but if the DACL has no ACE entries, the system will deny all access attempts. ACEs in the DACL are checked in sequence until a match is found that allows the requested rights or until access is denied.
- <u>System Access Control Lists (SACL)</u>: Allows for administrators to log access attempts that are made to secured objects. ACEs specify the types of access attempts that cause the system to generate a record in the security event log.
- <u>Fully Qualified Domain Name (FQDN)</u>: An FQDN is the complete name for a specific computer or host. It is written with the hostname and domain name in the format [host name].[domain name].[tld]. This is used to specify an object's location in the tree hierarchy of DNS. The FQDN can be used to locate hosts in an Active Directory without knowing the IP address, much like when browsing to a website such as google.com instead of typing in the associated IP address. An example would be the host `DC01` in the domain `INLANEFREIGHT.LOCAL`. The FQDN here would be `DC01.INLANEFREIGHT.LOCAL`.
- <u>Tombstone</u>: a container object in AD that holds deleted AD objects. When an object is deleted from AD, the object remains for a set period of time known as the `Tombstone Lifetime,` and the `isDeleted` attribute is set to `TRUE`. Once an object exceeds the `Tombstone Lifetime`, it will be entirely removed. Microsoft recommends a tombstone lifetime of 180 days to increase the usefulness of backups, but this value may differ across environments. Depending on the DC operating system version, this value will default to 60 or 180 days. If an object is deleted in a domain that does not have an AD Recycle Bin, it will become a tombstone object. When this happens, the object is stripped of most of its attributes and placed in the `Deleted Objects` container for the duration of the `tombstoneLifetime`. It can be recovered, but any attributes that were lost can no longer be recovered.
- <u>AD Recycle Bin</u>: made it easier for sysadmins to restore objects, avoiding the need to restore from backups, restarting Active Directory Domain Services (AD DS), or rebooting a Domain Controller. When the AD Recycle Bin is enabled, any deleted objects are preserved for a period of time, facilitating restoration if needed. Sysadmins can set how long an object remains in a deleted, recoverable state. If this is not specified, the object will be restorable for a default value of 60 days. The biggest advantage of using the AD Recycle Bin is that most of a deleted object's attributes are preserved, which makes it far easier to fully restore a deleted object to its previous state.
- <u>SYSVOL</u>: The [SYSVOL](https://social.technet.microsoft.com/wiki/contents/articles/8548.active-directory-sysvol-and-netlogon.aspx) folder, or share, stores copies of public files in the domain such as system policies, Group Policy settings, logon/logoff scripts, and often contains other types of scripts that are executed to perform various tasks in the AD environment. The contents of the SYSVOL folder are replicated to all DCs within the environment using File Replication Services (FRS). You can read more about the SYSVOL structure [here](http://www.techiebird.com/Sysvol_structure.html).
- <u>AdminSDHolder</u>: The AdminSDHolder object is used to manage ACLs for members of built-in groups in AD marked as privileged. It acts as a container that holds the Security Descriptor applied to members of protected groups. The SDProp (SD Propagator) process runs on a schedule on the PDC Emulator Domain Controller. When this process runs, it checks members of protected groups to ensure that the correct ACL is applied to them. It runs every hour by default. For example, suppose an attacker is able to create a malicious ACL entry to grant a user certain rights over a member of the Domain Admins group. In that case, unless they modify other settings in AD, these rights will be removed (and they will lose any persistence they were hoping to achieve) when the SDProp process runs on the set interval.
- <u>dsHeuristics</u>: The dsHeuristics attribute is a string value set on the Directory Service object used to define multiple forest-wide configuration settings. One of these settings is to exclude built-in groups from the Protected Groups list. Groups in this list are protected from modification via the AdminSDHolder object. If a group is excluded via the dsHeuristics attribute, then any changes that affect it will not be reverted when the SDProp process runs.
- <u>adminCount</u>: The adminCount attribute determines whether or not the SDProp process protects a user. If the value is set to 0 or not specified, the user is not protected. If the attribute value is set to value, the user is protected. Attackers will often look for accounts with the adminCount attribute set to 1 to target in an internal environment. These are often privileged accounts and may lead to further access or full domain compromise.
- <u>Active Directory Users and Computers (ADUC)</u>: a GUI console commonly used for managing users, groups, computers, and contacts in AD. Changes made in ADUC can be done via PowerShell as well.
- <u>ADSI Edit</u>: a GUI tool used to manage objects in AD. It provides access to far more than is available in ADUC and can be used to set or delete any attribute available on an object, add, remove, and move objects as well. It is a powerful tool that allows a user to access AD at a much deeper level. Great care should be taken when using this tool, as changes here could cause major problems in AD.
- <u>sIDHistory</u>: attribute that holds any SIDs that an object was assigned previously. It is usually used in migrations so a user can maintain the same level of access when migrated from one domain to another. This attribute can potentially be abused if set insecurely, allowing an attacker to gain prior elevated access that an account had before a migration if SID Filtering (or removing SIDs from another domain from a user's access token that could be used for elevated access) is not enabled.
- <u>NTDS.DIT</u>: file that can be considered the heart of Active Directory. It is stored on a Domain Controller at C:\Windows\NTDS\ and is a database that stores AD data such as information about user and group objects, group membership, and, most important to attackers and penetration testers, the password hashes for all users in the domain. Once full domain compromise is reached, an attacker can retrieve this file, extract the hashes, and either use them to perform a pass-the-hash attack or crack them offline using a tool such as Hashcat to access additional resources in the domain. If the setting Store password with reversible encryption is enabled, then the NTDS.DIT will also store the cleartext passwords for all users created or who changed their password after this policy was set. While rare, some organizations may enable this setting if they use applications or protocols that need to use a user's existing password (and not Kerberos) for authentication.
- <u>MSBROWSE</u>: a Microsoft networking protocol that was used in early versions of Windows-based local area networks (LANs) to provide browsing services. It was used to maintain a list of resources, such as shared printers and files, that were available on the network, and to allow users to easily browse and access these resources.

# Questions
- What is known as the "Blueprint" of an Active Directory environment?
	- `schema`
- What uniquely identifies a Service instance? (full name, space-separated, not abbreviated)
	- `Service Principal Name`
- True or False; Group Policy objects can be applied to user and computer objects.
	- `True`
- What container in AD holds deleted objects?
	- `Tombstone`
- What file contains the hashes of passwords for all users in a domain?
	- `NTDS.DIT`